name: Deploy to Server

on:
  push:
    branches:
      - main  # Esto escucha un 'push' en la rama principal

jobs:
  deploy:
    runs-on: ubuntu-latest  # El sistema operativo que se usará en GitHub Actions
    timeout-minutes: 15

    steps:        
    - name: Check out the repository
      uses: actions/checkout@v2  # Acción para clonar el repositorio en el entorno de GitHub Actions

    - name: Set up SSH for remote access
      uses: appleboy/ssh-action@v0.1.3  # Acción para conectarse al servidor remoto por SSH
      with:
        host: ${{ secrets.HOST }}  # Dirección IP o nombre del host del servidor (debe estar configurado en GitHub Secrets)
        username: ${{ secrets.USERNAME }}  # Nombre de usuario del servidor (debe estar configurado en GitHub Secrets)
        key: ${{ secrets.SSH_KEY }}  # Clave privada SSH para acceso (debe estar configurado en GitHub Secrets)
        passphrase: ${{ secrets.SSH_PASSPHRASE }}
        port: 22  # Puerto SSH (comúnmente 22)
        timeout: 15m

    - name: Pull latest changes and restart Podman containers
      run: |
        cd /beneficios  # Asegúrate de que esta ruta sea correcta en tu servidor
        git pull origin main  # Actualiza el repositorio en el servidor
        podman-compose up -d --build  # Reinicia los contenedores con los últimos cambios
